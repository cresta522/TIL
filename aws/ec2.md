# EC2
## 概要
- EC2は Elastic Compute Cloud の略
    - AWSの仮想サーバサービス

- EC2 は仮想的なコンピュータであるため OS, CPU, Memory, SSD, NIC が備わっている。各種装置はEC2上で別名となっている。
- 以下の塊を通常EC2と呼ぶ
    - OS -> AMI
    - CPU,Memory -> インスタンスタイプ
    - SSD -> EBS
    - NIC(Network Interface Card) -> ENI(Elastic Network Interface)

- サーバの土台はAWSが用意してくれるのでこのOSより上のレイヤーを自由に作り上げるのが使い方。

## AMI (Amazon Machine Image)
- EC2インスタンスが起動するときに必要となる設定(テンプレート)ファイル
- 一つのAMIでEC2の複製が可能
- OSやアプリケーション情報が設定されている
- OSは選択可能で、Amazon Linuxが一般的
    - 各種 Linux ディストリビューションがある
    - Windows Serverもあるよ

- どのユーザが起動できるのか、といった起動許可設定
- インスタンス起動時にどのEBSをアタッチするかの情報が入っている

## インスタンスタイプ
- EC2のCPU, Memoryのスペックパターン
- スペック構成により「インスタンスファミリー」と分類分けがされる
- 更にmicro, small, medium, large, xlargeのように、性能の選択肢が用意されている

- e.g.) **t2.micro**
    - `t2`: インスタンスファミリー (`2`は世代)
        - 世代は数字が大きいものほど最新。料金が最適化されていたりする。
        - 特に理由がなければ最新の世代を使うこと。
    - `micro`: インスタンスタイプ

- t系: テスト向き、CPUバースト(未使用時にパワーを貯めておく)
- m系: 本番向き、バランスが良い
- c系: CPU重視、他処理や科学技術
- g系: GPU重視、3Dグラフィックや動画処理
- r系: メモリ重視、DB系
- d系: ストレージ重視、データウェアハウス系
- i系: ストレージ重視、NoSQL系

## EBS
- EC2インスタンスが使用するディスクストレージ。
- AZで自動的に冗長化される。
- HDDとSSDから選べるが、デフォルトで汎用SSDがアタッチされる。
    - 汎用SSD: デフォルト。容量課金
    - プロビジョンドIOPS SSD: 贅沢なSSD。高性能DBへ接続する場合など高IOPSを担保する。
    - スループット最適化HDD: データウェアハウスやビッグデータ、ログ処理用
    - Cold HDD: コールド(通常泊まってるようなとき用)。安価で、アーカイブ保管用

### EBSのスナップショット
- スナップショット: EBSをバックアップとして取得したファイル
- 保管場所はS3
- スナップショット自体をEC2にアタッチ/デタッチはできない
- 増分バックアップ方式
    - 参考: [【今更聞けない】差分バックアップと増分バックアップの違いとメリット](https://www.backstore.jp/blog/2016/08/17/differential_and_increment_backup/)
- AZサービス
    - 自動的に冗長化されるので、高耐久性

## キーペア
- 作成したEC2インスタンスに誰でもアクセスできたら困るため、キーペアを作成し、ログイン管理をする。
    - 秘密鍵、公開鍵のペア
    - `ssh -i **.pem ec2-user@xx.xx.xx.xx`の秘密鍵として使用。
- 秘密鍵は再生性が可能。
    - AMIとしてバックアップを取得し、起動するときに新たなキーペアを作成するという方法。

## ユーザデータ
- インスタンス起動時にソフトウェアを最新化するなどのスタートアップスクリプトのこと。
    - 再起動時には実行されない。
    - root権限で実行される。

## インスタンスメタデータ
- EC2インスタンスに埋め込まれている自分の情報
    - 自信のIPアドレス、所属しているサブネットなどの情報を直接記載しないための処置
    - `curl http://xx.xx.xx.xx/latest/meta-data/` で取得ができる
    - `ec2-metadata` でも取得ができる
    - 詳細は インスタンスメタデータ で検索


## プレイスメントグループ
- 複数のEC2を論理的にグルーピングすること
    - 同一リージョン、同一AZのみ

    - グルーピングの種類
        - クラスター: HPC(High Performance Computing)といった高度な演算処理向け。基本的なグループ
        - パーティション: グルーピングを個別のラック(DC内部の)でグループ化するもの。対ハード障害
        - スプレッド: 個々のEC2を独立したラックに配置する。RAIDみたいな冗長化。

## Dedicatedインスタンス
- AWSの物理サーバのリソースを専有できること
    - 通常AWSの物理サーバは他のアカウントと共有している。
        - 医療データなど、他のアカウントと共有してしまうとコンプライアンス違反になるケースも有る